{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import axios from\"axios\";import{FiGift}from\"react-icons/fi\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||\"http://localhost:4000/api\";const Grandgagnant=()=>{const[error,setError]=useState(null);const[users,setUsers]=useState([]);const[gains,setGains]=useState([]);const[loading,setLoading]=useState(true);// const [searchTerm, setSearchTerm] = useState(\"\");\nconst[grandWinner,setGrandWinner]=useState(null);const[isDrawn,setIsDrawn]=useState(false);// Ajout d'un état pour vérifier si le tirage a été effectué\nuseEffect(()=>{const fetchData=async()=>{setLoading(true);setError(null);const token=localStorage.getItem(\"token\");if(!token){setError(\"Token d'authentification non trouvé. Merci de vous reconnecter.\");setLoading(false);return;}try{const headers={Authorization:`Bearer ${token}`};const[usersRes,gainsRes]=await Promise.all([axios.get(`${API_URL}/user/allclients`,{headers}),axios.get(`${API_URL}/user/usersgains`,{headers})]);setUsers(usersRes.data.clients||[]);setGains(gainsRes.data.gains||[]);}catch(err){var _err$response,_err$response$data;console.error(\"Erreur lors de la récupération des données :\",err.response||err);setError(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||\"Impossible de récupérer les données.\");}finally{setLoading(false);}};fetchData();},[]);// Fonction pour sélectionner un grand gagnant aléatoire\nconst handleGrandTirage=()=>{const winners=gains.filter(gain=>gain.prizeValue>0);// Gagnants avec des lots\nif(winners.length===0){setError(\"Aucun gagnant disponible pour le tirage.\");return;}// Trouver un gagnant\nconst randomIndex=Math.floor(Math.random()*winners.length);const selectedWinner=winners[randomIndex];// Vérifier si le gagnant a un utilisateur associé\nconst winnerUser=users.find(user=>user._id===selectedWinner.userId);if(winnerUser){setGrandWinner(winnerUser);// Mettre à jour le grand gagnant\nsetIsDrawn(true);// Marquer que le tirage a été effectué\n}else{setError(\"Utilisateur non trouvé pour le gagnant sélectionné.\");}};return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 md:p-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900 mb-6 text-center\",children:\"Grand gagnant de l'ann\\xE9e 2025 \"}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-32\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600\"})}):error?/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-md\",children:/*#__PURE__*/_jsx(\"p\",{children:error})}):/*#__PURE__*/_jsx(\"div\",{className:\"hidden\",children:gains.filter(gain=>gain.prizeValue>0)// Filtrer les gagnants\n.map((gain,index)=>{const user=users.find(u=>u._id===gain.userId);// Trouver l'utilisateur correspondant\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between py-3 border-b border-gray-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(FiGift,{className:\"text-green-500 text-xl\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-gray-700 font-medium\",children:user===null||user===void 0?void 0:user.userName})]}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-700\",children:user===null||user===void 0?void 0:user.email}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-700\",children:[gain.prizeValue,\" \\u20AC\"]})]},index);})}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 text-center\",children:/*#__PURE__*/_jsx(\"button\",{onClick:handleGrandTirage,className:\"px-6 py-3 bg-blue-600 text-white rounded-lg shadow-lg hover:bg-blue-700\",disabled:isDrawn// Désactive le bouton si le tirage a déjà été effectué\n,children:\"Lancer le jeu\"})}),grandWinner&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 text-center bg-green-100 text-green-800 p-4 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-bold\",children:[\"F\\xE9licitations \\xE0 \",grandWinner.userName,\" \",grandWinner.email,\"!\"]}),/*#__PURE__*/_jsx(\"p\",{children:\"Vous aviez remport\\xE9 le grand concours gagnant d'une valeur de 360\\u20AC pour l'ann\\xE9e Th\\xE9 Tip Top 2025 \"})]})]});};export default Grandgagnant;","map":{"version":3,"names":["React","useState","useEffect","axios","FiGift","jsx","_jsx","jsxs","_jsxs","API_URL","process","env","REACT_APP_API_URL","Grandgagnant","error","setError","users","setUsers","gains","setGains","loading","setLoading","grandWinner","setGrandWinner","isDrawn","setIsDrawn","fetchData","token","localStorage","getItem","headers","Authorization","usersRes","gainsRes","Promise","all","get","data","clients","err","_err$response","_err$response$data","console","response","message","handleGrandTirage","winners","filter","gain","prizeValue","length","randomIndex","Math","floor","random","selectedWinner","winnerUser","find","user","_id","userId","className","children","map","index","u","userName","email","onClick","disabled"],"sources":["C:/Users/achra/Desktop/tiptop/THETIPTOP_GAME/frontend/src/pages/Grandgagnant/Grandgagnant.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { FiGift } from \"react-icons/fi\";\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:4000/api\";\r\n\r\nconst Grandgagnant = () => {\r\n  const [error, setError] = useState(null);\r\n  const [users, setUsers] = useState([]);\r\n  const [gains, setGains] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  // const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [grandWinner, setGrandWinner] = useState(null);\r\n  const [isDrawn, setIsDrawn] = useState(false); // Ajout d'un état pour vérifier si le tirage a été effectué\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      const token = localStorage.getItem(\"token\");\r\n      if (!token) {\r\n        setError(\"Token d'authentification non trouvé. Merci de vous reconnecter.\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const headers = { Authorization: `Bearer ${token}` };\r\n        const [usersRes, gainsRes] = await Promise.all([\r\n          axios.get(`${API_URL}/user/allclients`, { headers }),\r\n          axios.get(`${API_URL}/user/usersgains`, { headers }),\r\n        ]);\r\n\r\n        setUsers(usersRes.data.clients || []);\r\n        setGains(gainsRes.data.gains || []);\r\n      } catch (err) {\r\n        console.error(\"Erreur lors de la récupération des données :\", err.response || err);\r\n        setError(err.response?.data?.message || \"Impossible de récupérer les données.\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  // Fonction pour sélectionner un grand gagnant aléatoire\r\n  const handleGrandTirage = () => {\r\n    const winners = gains.filter((gain) => gain.prizeValue > 0); // Gagnants avec des lots\r\n    if (winners.length === 0) {\r\n      setError(\"Aucun gagnant disponible pour le tirage.\");\r\n      return;\r\n    }\r\n\r\n    // Trouver un gagnant\r\n    const randomIndex = Math.floor(Math.random() * winners.length);\r\n    const selectedWinner = winners[randomIndex];\r\n\r\n    // Vérifier si le gagnant a un utilisateur associé\r\n    const winnerUser = users.find((user) => user._id === selectedWinner.userId);\r\n\r\n    if (winnerUser) {\r\n      setGrandWinner(winnerUser); // Mettre à jour le grand gagnant\r\n      setIsDrawn(true); // Marquer que le tirage a été effectué\r\n    } else {\r\n      setError(\"Utilisateur non trouvé pour le gagnant sélectionné.\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4 md:p-8\">\r\n      <h1 className=\"text-2xl font-bold text-gray-900 mb-6 text-center\">Grand gagnant de l'année 2025 </h1>\r\n\r\n      {/* Liste des gagnants (invisible pour le frontend) */}\r\n      {loading ? (\r\n        <div className=\"flex justify-center items-center h-32\">\r\n          <div className=\"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      ) : error ? (\r\n        <div className=\"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded-md\">\r\n          <p>{error}</p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"hidden\"> \r\n          {gains\r\n            .filter((gain) => gain.prizeValue > 0) // Filtrer les gagnants\r\n            .map((gain, index) => {\r\n              const user = users.find((u) => u._id === gain.userId); // Trouver l'utilisateur correspondant\r\n              return (\r\n                <div key={index} className=\"flex items-center justify-between py-3 border-b border-gray-200\">\r\n                  <div className=\"flex items-center\">\r\n                    <FiGift className=\"text-green-500 text-xl\" />\r\n                    <span className=\"ml-2 text-gray-700 font-medium\">{user?.userName}</span>\r\n                  </div>\r\n                  <span className=\"text-gray-700\">{user?.email}</span>\r\n                  <span className=\"text-gray-700\">{gain.prizeValue} €</span>\r\n                </div>\r\n              );\r\n            })}\r\n        </div>\r\n      )}\r\n\r\n      {/* Bouton Tirage Grand Gagnant */}\r\n      <div className=\"mt-6 text-center\">\r\n        <button\r\n          onClick={handleGrandTirage}\r\n          className=\"px-6 py-3 bg-blue-600 text-white rounded-lg shadow-lg hover:bg-blue-700\"\r\n          disabled={isDrawn} // Désactive le bouton si le tirage a déjà été effectué\r\n        >\r\n          Lancer le jeu\r\n        </button>\r\n      </div>\r\n\r\n      {/* Affichage du Grand Gagnant avec valeur fixe de 360€ */}\r\n      {grandWinner && (\r\n        <div className=\"mt-6 text-center bg-green-100 text-green-800 p-4 rounded-lg\">\r\n          <h3 className=\"text-xl font-bold\">Félicitations à {grandWinner.userName} {grandWinner.email}!</h3>\r\n          <p>Vous aviez remporté le grand concours gagnant d'une valeur de 360€ pour l'année Thé Tip Top 2025 </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Grandgagnant;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}